<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTHREE — Dashboard</title>
  <meta name="description" content="Dashboard PTHREE — Komunitas Baca SMAN 2 Muara Teweh">
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    :root{
      --bg:#ffffff; --surface:#f7f9fc; --text:#0b0f14; --muted:#5b6673;
      --accent:#1e88e5; --accent-2:#111827;
      --border:1px solid rgba(17,24,39,.08);
      --shadow:0 10px 24px rgba(2,6,23,.08);
      --radius:14px; --container:1200px; --ease:cubic-bezier(.22,.61,.36,1);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth;scroll-padding-top:72px}
    body{margin:0;font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:var(--container);margin:auto;padding:0 1rem}

    /* ===== NAVBAR V2: desktop inline + logo (tema tetap) ===== */
    .topbar{position:sticky;top:0;z-index:60;background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}
    .topbar-inner{display:flex;align-items:center;justify-content:space-between;height:72px}
    .brand{font-weight:800;letter-spacing:.2px;color:var(--accent-2)}
    .brand-wrap{display:inline-flex;align-items:center;gap:.6rem;text-decoration:none}
    .brand-logo{width:28px;height:28px;object-fit:cover;display:block;border-radius:6px}

    .hamb{width:40px;height:40px;border-radius:10px;border:1px solid rgba(2,6,23,.12);display:grid;place-content:center;background:#fff;cursor:pointer}
    .hamb i{font-size:18px;color:var(--accent-2)}

    .nav-inline{display:none;align-items:center;gap:.25rem}
    .nav-inline .nav-link{
      display:inline-block;padding:10px 12px;border-radius:10px;font-weight:600;
      color:var(--accent-2);opacity:.9;text-decoration:none
    }
    .nav-inline .nav-link:hover{background:rgba(2,6,23,.05);opacity:1;text-decoration:none}
    .nav-inline .nav-link.active{
      background:rgba(2,6,23,.06);
      box-shadow:inset 0 0 0 1px rgba(2,6,23,.08);
      opacity:1
    }
    @media (min-width:900px){
      .nav-inline{display:flex}
      .hamb{display:none}
    }

    /* Overlay menu (punyamu) */
    .mobile-menu{position:fixed;inset:0;background:var(--accent-2);color:#fff;transform:translateY(-100%);opacity:0;pointer-events:none;transition:transform .35s var(--ease),opacity .35s ease;display:flex;flex-direction:column;z-index:999}
    .mobile-menu.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .mobile-menu__bar{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid rgba(255,255,255,.12)}
    .mobile-menu__close{width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.18);display:grid;place-content:center;cursor:pointer;color:#fff}
    .mobile-menu__links{display:flex;flex-direction:column;gap:8px;padding:24px 16px;max-width:var(--container);margin:32px auto 0}
    .mobile-menu__links a{display:block;padding:16px 12px;border-radius:12px;color:#fff;font-weight:700;font-size:1.2rem;border:1px solid rgba(255,255,255,.12)}
    .mobile-menu__links a.active{background:#0f172a;border-color:rgba(255,255,255,.22)}
    .no-scroll{overflow:hidden}

    /* ===== CONTENT ===== */
    main{padding:1rem 0}
    .section{padding:2.2rem 0}
    .sep{border:none;height:1px;background:linear-gradient(90deg,transparent,rgba(2,6,23,.15),transparent);margin:1rem 0 1.5rem}

    .hero{display:grid;gap:1rem;grid-template-columns:1fr;align-items:center;padding:1.5rem 0}
    .hero h1{font-size:clamp(2rem,2.2vw + 1rem,3rem);margin:.2rem 0}
    .hero p{color:var(--muted);margin:0}
    .hero-card{background:var(--surface);border:var(--border);border-radius:var(--radius);padding:1rem;display:grid;gap:1rem;box-shadow:var(--shadow)}
    .stats{display:grid;gap:.8rem;grid-template-columns:repeat(3,1fr)}
    .stat{background:#fff;border:var(--border);border-radius:12px;padding:1rem;text-align:center}
    .stat b{display:block;font-size:1.25rem}

    .masonry{column-count:1;column-gap:1rem}
    .masonry img{width:100%;display:block;margin:0 0 1rem;border-radius:12px;background:#fff;box-shadow:var(--shadow)}
    @media (min-width:640px){.masonry{column-count:2}}
    @media (min-width:1024px){.masonry{column-count:3}}

    .video-grid{display:grid;gap:1rem;grid-template-columns:1fr}
    .video-grid iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:12px;box-shadow:var(--shadow)}
    @media (min-width:768px){.video-grid{grid-template-columns:1fr 1fr}}

    .book-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .book{background:#fff;border:var(--border);border-radius:12px;padding:1rem;box-shadow:var(--shadow);transition:transform .2s}
    .book:hover{transform:translateY(-3px)}
    .book img{width:100%;border-radius:10px;aspect-ratio:3/4;object-fit:cover}
    .book h3{margin:.6rem 0 .2rem;font-size:1.05rem}
    .book p{margin:0;color:var(--muted)}

    footer{text-align:center;padding:2.2rem 0 3rem;color:var(--muted)}
    .social a{margin:0 .35rem;display:inline-grid;place-content:center;width:40px;height:40px;border-radius:50%;border:1px solid rgba(2,6,23,.12)}
    .btn{display:inline-flex;align-items:center;gap:.5rem;background:var(--accent);color:#fff;border:0;padding:.7rem 1rem;border-radius:999px;font-weight:700}

    /* ===== Smooth reveal + page transition fallback ===== */
    .reveal{opacity:0;transform:translateY(14px);transition:opacity .55s var(--ease),transform .55s var(--ease);will-change:opacity,transform}
    .reveal.visible{opacity:1;transform:none}
    .reveal-stagger>*{opacity:0;transform:translateY(12px);transition:opacity .6s var(--ease),transform .6s var(--ease)}
    .reveal-stagger.visible>*{opacity:1;transform:none}
    .reveal-stagger.visible>*:nth-child(1){transition-delay:.05s}
    .reveal-stagger.visible>*:nth-child(2){transition-delay:.12s}
    .reveal-stagger.visible>*:nth-child(3){transition-delay:.19s}
    .reveal-stagger.visible>*:nth-child(4){transition-delay:.26s}
    .reveal-stagger.visible>*:nth-child(5){transition-delay:.33s}
    body.page-enter{animation:pageIn .35s var(--ease) both}
    body.page-exit{animation:pageOut .22s var(--ease) both}
    @keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    @keyframes pageOut{to{opacity:0;transform:translateY(6px)}}

    .btn{
  display:inline-flex;
  align-items:center;
  gap:.5rem;
  background:var(--accent);
  color:#fff;
  border:0;
  padding:.6rem 1rem;
  border-radius:999px;
  font-weight:700;
  font-size:.9rem;
  text-decoration:none;
  transition:background .25s;
}
.btn:hover{
  background:#1565c0;
  text-decoration:none;
}

/* === MOBILE NAV REDESIGN (drawer) — overrides & additions === */
header .mobile-menu{
  position:fixed; inset:0; z-index:999;
  /* Override animasi lama: kontainer tetap di tempat, panel yang bergerak */
  transform:none !important;
  opacity:1 !important;
  background:transparent !important;
  pointer-events:none;
  display:block;
}
header .mobile-menu.open{ pointer-events:auto; }

/* Backdrop gelap */
.mobile-menu__backdrop{
  position:absolute; inset:0;
  background:rgba(2,6,23,.55);
  opacity:0;
  transition:opacity .25s var(--ease);
}
.mobile-menu.open .mobile-menu__backdrop{ opacity:1; }

/* Panel drawer (kanan) */
.mobile-menu__panel{
  position:absolute; top:0; right:0; height:100%;
  width:min(88vw,380px);
  background:var(--accent-2); color:#fff;
  box-shadow:-16px 0 32px rgba(2,6,23,.18);
  border-left:1px solid rgba(255,255,255,.12);
  transform:translateX(100%);
  transition:transform .35s var(--ease);
  display:flex; flex-direction:column;
  padding-bottom:env(safe-area-inset-bottom);
}
.mobile-menu.open .mobile-menu__panel{ transform:translateX(0); }

/* Bar atas & tombol close (tetap dari gaya lama, dipertegas) */
.mobile-menu__bar{
  display:flex; align-items:center; justify-content:space-between;
  padding:16px; border-bottom:1px solid rgba(255,255,255,.12);
}
.mobile-menu__close{
  width:40px; height:40px; border-radius:10px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.18);
  display:grid; place-content:center; cursor:pointer; color:#fff;
}

/* Link list */
.mobile-menu__links{
  display:flex; flex-direction:column; gap:10px;
  padding:20px 16px 24px;
  overflow:auto; -webkit-overflow-scrolling:touch;
  max-height:100%;
}
.mobile-menu__links a{
  display:block; padding:14px 12px; border-radius:12px;
  color:#fff; font-weight:700; font-size:1.05rem;
  border:1px solid rgba(255,255,255,.12); text-decoration:none;
}
.mobile-menu__links a:hover{ background:rgba(255,255,255,.06); }
.mobile-menu__links a.active{
  background:#0f172a; border-color:rgba(255,255,255,.22);
}

/* Sembunyikan menu mobile di desktop */
@media (min-width:900px){ .mobile-menu{ display:none !important; } }

/* Aksesibilitas & preferensi reduce motion */
@media (prefers-reduced-motion:reduce){
  .mobile-menu__backdrop, .mobile-menu__panel{ transition:none; }
}

/* Lock scroll yang lebih stabil saat drawer terbuka */
.no-scroll{
  position:fixed; inset:0; overflow:hidden;
}

/* === FIX NAVBAR HILANG SAAT SCROLL (TAMBAHAN, TANPA HAPUS KODE AWAL) === */
:root{ --topbar-h:72px; }
/* Pastikan anchor scroll offset pakai tinggi header */
html{ scroll-padding-top: var(--topbar-h) !important; }
/* Di mobile: jadikan header benar-benar fixed agar tidak “lepas” saat scroll (iOS/Android) */
@media (max-width:899.98px){
  .topbar{ position:fixed !important; top:0; left:0; right:0; z-index:1000; }
  body{ padding-top: var(--topbar-h); }
}
/* Saat menu tertutup, overlay benar-benar tidak terlihat & tidak menutupi header */
header .mobile-menu{ visibility:hidden; }
header .mobile-menu.open{ visibility:visible; }
/* Saat menu dibuka, overlay di atas header */
header .mobile-menu.open{ z-index:2000 !important; }

#backToTop{
  position:fixed;
  bottom:24px;
  right:24px;
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:var(--accent);
  color:#fff;
  font-size:18px;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.2);
  opacity:0;
  visibility:hidden;
  transition:opacity .3s,visibility .3s,transform .3s;
  z-index:1000;
}
#backToTop:hover{
  background:#1565c0;
  transform:translateY(-3px);
}
#backToTop.show{
  opacity:1;
  visibility:visible;
}

/* === LOCK HORIZONTAL SCROLL & OVERSCROLL (mobile-safe) === */
html, body{
  max-width:100%;
  overflow-x:hidden;           /* cegah halaman geser ke kanan */
  overscroll-behavior-x:none;  /* matikan bounce/geser balik di Android */
  touch-action:pan-y;          /* kunci gesture ke vertikal */
}
/* pastikan kontainer besar tak melewati lebar viewport */
.container,
.carousel,
.masonry,
.video-grid{
  max-width:100vw;
}
/* jaga media tidak meluber */
img, iframe{
  max-width:100%;
}
/* opsi iOS: tetap smooth */
body{
  -webkit-overflow-scrolling: touch;
}

  </style>
</head>
<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <a href="index.html" class="brand-wrap" aria-label="Beranda PTHREE">
        <img src="https://i.imgur.com/u2k2fsE.jpg" alt="Logo PTHREE" class="brand-logo">
        <span class="brand">PTHREE</span>
      </a>

      <nav class="nav-inline" aria-label="Navigasi utama">
        <a class="nav-link active" href="index.html" aria-current="page">Dashboard</a>
        <a class="nav-link" href="kegiatan.html">Kegiatan</a>
        <a class="nav-link" href="tentang.html">Tentang</a>
        <a class="nav-link" href="kontak.html">Kontak</a>
      </nav>

      <button class="hamb" id="hamb" aria-label="Buka menu" aria-controls="menu" aria-expanded="false">
        <i class="fa fa-bars"></i>
      </button>
    </div>

    <!-- Overlay menu (mobile) — drawer kanan + backdrop -->
   <nav class="mobile-menu" id="menu" aria-label="Navigasi seluler" aria-hidden="true">
  <div class="mobile-menu__backdrop" data-close></div>

  <div class="mobile-menu__panel" role="dialog" aria-modal="true" aria-labelledby="mobileMenuTitle">
    <div class="mobile-menu__bar">
      <strong id="mobileMenuTitle">PTHREE</strong>
      <button class="mobile-menu__close" id="closeMenu" aria-label="Tutup menu" data-close>
        <i class="fa fa-close" aria-hidden="true"></i>
      </button>
    </div>

    <div class="mobile-menu__links">
      <a class="active" href="index.html" aria-current="page">Dashboard</a>
      <a href="kegiatan.html">Kegiatan</a>
      <a href="tentang.html">Tentang</a>
      <a href="kontak.html">Kontak</a>
    </div>
  </div>
</nav>
  </header>

  <main class="container">
    <!-- HERO -->
    <section class="hero reveal-stagger" id="home">
      <div class="hero-card reveal-stagger">
        <span style="background:#e9f3ff;color:var(--accent);font-weight:700;border-radius:999px;padding:.25rem .6rem">Komunitas Baca</span>
        <h1 class="reveal"><b>PTHREE</b> — SMAN 2 Muara Teweh</h1>
        <p class="reveal">Aktif membaca, berdiskusi, dan berkarya setiap hari Jumat untuk menumbuhkan budaya literasi.</p>
        <div class="stats reveal-stagger">
          <div class="stat"><b>2023</b><span>Sejak</span></div>
          <div class="stat"><b>22+</b><span>Anggota</span></div>
          <div class="stat"><b>10+</b><span>Karya & Kegiatan</span></div>
        </div>
        <div class="reveal"><a class="btn" href="https://www.instagram.com/pthree.smada" target="_blank" rel="noopener"><i class="fa fa-instagram"></i> Ikuti Instagram</a></div>
      </div>
    </section>

    <!-- KEGIATAN (ringkas) -->
    <section class="section reveal" id="kegiatan">
      <h2>Kegiatan Terbaru</h2>
      <hr class="sep">
      <div class="masonry">
        <img src="https://ik.imagekit.io/3fgrgeqi6z/WhatsApp%20Image%202025-02-06%20at%2013.58.08_e13edae4.jpg?updatedAt=1761223838127" alt="Kegiatan 1" loading="lazy" decoding="async">
        <img src="https://ik.imagekit.io/3fgrgeqi6z/WhatsApp%20Image%202024-11-26%20at%2016.50.57_e0c09027.jpg?updatedAt=1761224200756" alt="Kegiatan 2" loading="lazy" decoding="async">
        <img src="https://i.imgur.com/VwV8I4m.jpeg" alt="Kegiatan 3" loading="lazy" decoding="async">
      </div>
      <p><a href="kegiatan.html">Lihat semua kegiatan →</a></p>
    </section>

    <!-- KARYA (YouTube) -->
    <section class="section reveal" id="karya">
      <h2>Video Karya</h2>
      <hr class="sep">
      <div class="video-grid reveal-stagger">
        <iframe loading="lazy" src="https://www.youtube.com/embed/L-dse6L49-k" title="Video 1 PTHREE" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe loading="lazy" src="https://www.youtube.com/embed/Ag1SyxpAzCU" title="Video 2 PTHREE" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe loading="lazy" src="https://www.youtube.com/embed/gSqJbFacvMM?si=sKNXov8zYvpnju9w" title="Video 3 PTHREE" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe loading="lazy" src="https://www.youtube.com/embed/PxhBMUCStkA" title="Video 3 PTHREE" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>
    </section>

    <!-- REKOMENDASI BUKU -->
    <section class="section reveal" id="buku">
  <h2>Rekomendasi Buku</h2>
  <hr class="sep">
  <div class="book-grid reveal-stagger">
    <article class="book">
      <img src="https://i.imgur.com/WokBkPp.jpeg" alt="The Little Prince" loading="lazy" decoding="async">
      <h3>Kakahdou</h3>
      <p>SANDRA AULIA</p>
      <a class="btn" href="https://read.bookcreator.com/library/-O89XanKt2l1UbYrNg1B/book/9NmOUzEIRSGPL139h8eQqw/W6RE4i3pRWmgth-Z_l5oyg" target="_blank" rel="noopener">
        <i class="fa fa-book"></i> Baca Selengkapnya
      </a>
    </article>

    <article class="book">
      <img src="https://i.imgur.com/l7TcVrm.jpeg" alt="Laut Bercerita" loading="lazy" decoding="async">
      <h3>Legenda dari Hantuen</h3>
      <p>MEILINA AURELIA HOSHI</p>
      <a class="btn" href="http://read.bookcreator.com/library/-O89XanKt2l1UbYrNg1B/book/NZAdHgM3QsafA3XnwsT9wQ/vAgCASS_RAG0Pe42kObOCA" target="_blank" rel="noopener">
        <i class="fa fa-book"></i> Baca Selengkapnya
      </a>
    </article>

    <article class="book">
      <img src="https://i.imgur.com/rXRC0V9.jpeg" alt="Filosofi Teras" loading="lazy" decoding="async">
      <h3>Saluh</h3>
      <p> ASKA LAURA</p>
      <a class="btn" href="https://read.bookcreator.com/library/-O89XanKt2l1UbYrNg1B/book/8BWLmWr9TEWTRRvcw-kvVA/EK3QjNtEQP-TvaJhEKd7Yg" target="_blank" rel="noopener">
        <i class="fa fa-book"></i> Baca Selengkapnya
      </a>
    </article>

    <article class="book">
      <img src="https://i.imgur.com/fInucKx.jpeg" alt="Filosofi Teras" loading="lazy" decoding="async">
      <h3>Puisi Renjana Amerta</h3>
      <p>MELANISYA</p>
      <a class="btn" href="https://read.bookcreator.com/library/-O89XanKt2l1UbYrNg1B/book/wwIrbUqtQvmNk4UcUGKiwQ/OpgBtw14S_K_SRLsNr1I9Q" target="_blank" rel="noopener">
        <i class="fa fa-book"></i> Baca Selengkapnya
      </a>
    </article>
  </div>
</section>

    <footer class="reveal">
      <div class="social">
        <a href="https://www.instagram.com/pthree.smada" target="_blank" aria-label="Instagram"><i class="fa fa-instagram"></i></a>
        <a href="https://www.facebook.com/profile.php?id=61551546172231&mibextid=ZbWKwL" target="_blank" aria-label="Facebook"><i class="fa fa-facebook-official"></i></a>
      </div>
      <p>© PTHREE 2025</p>
    </footer>
  </main>
<button id="backToTop" aria-label="Kembali ke atas">
  <i class="fa fa-arrow-up"></i>
</button>
  <script>
/* ======== MENU OVERLAY (drawer) + A11y (replaces old bindMenu) ======== */
function bindMenu(){
  const hamb = document.getElementById('hamb');
  const menu = document.getElementById('menu');
  if (!hamb || !menu) return;

  const panel    = menu.querySelector('.mobile-menu__panel') || menu; // fallback aman
  const backdrop = menu.querySelector('.mobile-menu__backdrop');
  let lastFocus  = null;
  let lastScrollY = 0;

  const focusableSel = 'a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])';

  function trapFocus(e){
    if (e.key !== 'Tab') return;
    const nodes = panel.querySelectorAll(focusableSel);
    if (!nodes.length) return;
    const first = nodes[0];
    const last  = nodes[nodes.length - 1];

    if (e.shiftKey && document.activeElement === first){
      e.preventDefault(); last.focus();
    } else if (!e.shiftKey && document.activeElement === last){
      e.preventDefault(); first.focus();
    }
  }

  function onKeydown(e){
    if (e.key === 'Escape') closeMenu();
    trapFocus(e);
  }

  function openMenu(){
    menu.classList.add('open');
    menu.setAttribute('aria-hidden','false');
    hamb.setAttribute('aria-expanded','true');

    lastFocus = document.activeElement;
    lastScrollY = window.scrollY || 0;
    document.body.classList.add('no-scroll');
    document.body.style.top = -lastScrollY + 'px';

    const firstFocusable = panel.querySelector('[data-autofocus]') || panel.querySelector(focusableSel);
    if (firstFocusable) firstFocusable.focus({ preventScroll:true });

    document.addEventListener('keydown', onKeydown);
  }

  function closeMenu(){
    menu.classList.remove('open');
    menu.setAttribute('aria-hidden','true');
    hamb.setAttribute('aria-expanded','false');

    document.body.classList.remove('no-scroll');
    document.body.style.top = '';
    window.scrollTo(0, lastScrollY);

    document.removeEventListener('keydown', onKeydown);
    if (lastFocus && lastFocus.focus) lastFocus.focus({ preventScroll:true });
  }

  hamb.addEventListener('click', openMenu);

  // Tutup saat klik backdrop, tombol close, atau link di dalam panel
  menu.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close]')) { closeMenu(); return; }
    const link = e.target.closest('a[href]');
    if (link) closeMenu();
  });

  if (backdrop) backdrop.addEventListener('click', closeMenu);
}

/* ======== SCROLL REVEAL (once) ======== */
function initReveals(){
  const els = document.querySelectorAll('.reveal, .reveal-stagger');
  if (!els.length) return;
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(ent=>{
      if(ent.isIntersecting){
        ent.target.classList.add('visible');
        io.unobserve(ent.target);
      }
    });
  }, { threshold: .18, rootMargin: "0px 0px -10% 0px" });
  els.forEach(el=>io.observe(el));
}

/* ======== SLIDER KEGIATAN (optional) ======== */
function initSliderIfExists(){
  const track = document.getElementById('track');
  if (!track) return; // halaman lain aman

  const slides = Array.from(track.children);
  const dotsWrap = document.getElementById('dots');
  let idx=0, startX=0, down=false, auto=null;
  const reduce = matchMedia('(prefers-reduced-motion:reduce)').matches;

  const setX = (px)=>{ track.style.transform = `translateX(${px}px)`; };
  const W = ()=> track.clientWidth;

  function go(i, trans=true){
    idx = (i + slides.length) % slides.length;
    track.style.transition = trans ? 'transform .5s cubic-bezier(.22,.61,.36,1)' : 'none';
    setX(-idx * W());
    paint();
  }
  function paint(){
    if (!dotsWrap) return;
    dotsWrap.innerHTML = '';
    slides.forEach((_,i)=>{
      const d = document.createElement('span');
      d.className = 'dot' + (i===idx ? ' active' : '');
      dotsWrap.appendChild(d);
    });
  }
  const getX = (e)=> (e.touches? e.touches[0].clientX : e.clientX) || 0;
  function downFn(e){ down=true; startX = getX(e) + idx*W(); track.style.transition='none'; stopAuto(); }
  function moveFn(e){ if(!down) return; setX(-(startX - getX(e))); }
  function upFn(e){
    if(!down) return; down=false;
    const moved = startX - getX(e), th = W()*0.15;
    if (moved >  th) go(idx+1);
    else if (moved < -th) go(idx-1);
    else go(idx);
    playAuto();
  }

  track.addEventListener('touchstart',downFn,{passive:true});
  track.addEventListener('touchmove', moveFn,{passive:true});
  track.addEventListener('touchend',  upFn);
  track.addEventListener('mousedown',(e)=>{ e.preventDefault(); downFn(e); });
  window.addEventListener('mousemove',moveFn);
  window.addEventListener('mouseup',  upFn);
  window.addEventListener('resize',()=>go(idx,false));

  function playAuto(){ if(reduce) return; stopAuto(); auto = setInterval(()=>go(idx+1), 5000); }
  function stopAuto(){ if(auto) clearInterval(auto); auto=null; }
  track.addEventListener('mouseenter',stopAuto);
  track.addEventListener('mouseleave',playAuto);
  document.addEventListener('visibilitychange',()=>{ document.hidden ? stopAuto() : playAuto(); });

  go(0,false); playAuto();
}

/* ======== SMOOTH PAGE TRANSITION (fade-out -> navigate) ======== */
function initPageTransitions(){
  document.body.classList.add('page-enter');

  const isInternal = (a)=>{
    try { return a.origin === location.origin && !a.hasAttribute('download') && !a.target; }
    catch { return false; }
  };

  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a');
    if (!a) return;

    const href = a.getAttribute('href') || '';
    if (href.startsWith('#')) return;
    if (!isInternal(a)) return;

    if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.button === 1) return;

    e.preventDefault();
    document.body.classList.add('page-exit');
    setTimeout(()=>{ window.location.href = a.href; }, 220);
  });
}

/* ==== RUN ==== */
bindMenu();
initReveals();
initSliderIfExists();
initPageTransitions();

const backToTop = document.getElementById('backToTop');
if(backToTop){
  window.addEventListener('scroll', ()=>{
    if(window.scrollY > 400) backToTop.classList.add('show');
    else backToTop.classList.remove('show');
  });
  backToTop.addEventListener('click', ()=>{
    window.scrollTo({top:0, behavior:'smooth'});
  });
}
</script>

</body>

</html>
